# 前端项目 API 接口对接文档

## 项目概述
本文档用于前后端接口对接，基于 Vue 前端项目的 API 调用整理而成。后端建议使用 Node.js + Express 框架实现。

## 技术栈要求
- **后端框架**: Node.js + Express
- **数据格式**: JSON
- **请求方式**: RESTful API
- **认证方式**: 建议使用 JWT Token（需在请求头中携带）

---

## 接口规范

### 通用响应格式
```json
{
  "code": 200,           // 状态码：200 成功，其他为失败
  "message": "success",  // 提示信息
  "data": {}            // 响应数据
}
```

### 通用请求头
```
Content-Type: application/json
Authorization: Bearer <token>  // 需要认证的接口
```

---

## 1. 用户模块 (User)

### 1.1 用户登录
- **接口路径**: `POST /user/login`
- **请求参数**:
```json
{
  "username": "string",  // 用户名
  "password": "string"   // 密码
}
```
- **响应数据**:
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "string",      // JWT token
    "userInfo": {
      "id": "number",
      "username": "string",
      "email": "string",
      "avatar": "string"
    }
  }
}
```

### 1.2 用户注册
- **接口路径**: `POST /user/register`
- **请求参数**:
```json
{
  "username": "string",  // 用户名
  "password": "string",  // 密码
  "email": "string"      // 邮箱（可选）
}
```
- **响应数据**:
```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "userId": "number"
  }
}
```

### 1.3 获取用户信息
- **接口路径**: `GET /user/info`
- **请求参数**: 无（需要 token）
- **响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "number",
    "username": "string",
    "email": "string",
    "avatar": "string",
    "phone": "string",
    "createdAt": "string"
  }
}
```

### 1.4 更新用户信息
- **接口路径**: `POST /user/update`
- **请求参数**:
```json
{
  "username": "string",  // 可选
  "email": "string",     // 可选
  "avatar": "string",    // 可选
  "phone": "string"      // 可选
}
```
- **响应数据**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

---

## 2. 商品模块 (Product)

### 2.1 获取商品列表
- **接口路径**: `GET /product/list`
- **请求参数** (Query):
```
categoryId: number    // 分类ID（可选）
page: number         // 页码，默认 1
pageSize: number     // 每页数量，默认 10
sortBy: string       // 排序字段（可选）：price, sales, createdAt
order: string        // 排序方式（可选）：asc, desc
```
- **响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": "number",
        "name": "string",
        "price": "number",
        "originalPrice": "number",
        "image": "string",
        "images": ["string"],
        "description": "string",
        "stock": "number",
        "sales": "number",
        "categoryId": "number"
      }
    ],
    "total": "number",
    "page": "number",
    "pageSize": "number"
  }
}
```

### 2.2 获取商品详情
- **接口路径**: `GET /product/:id`
- **请求参数**: 
  - `id`: 商品ID（路径参数）
- **响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "number",
    "name": "string",
    "price": "number",
    "originalPrice": "number",
    "image": "string",
    "images": ["string"],
    "description": "string",
    "detail": "string",
    "stock": "number",
    "sales": "number",
    "categoryId": "number",
    "specs": "array"  // 商品规格
  }
}
```

### 2.3 搜索商品
- **接口路径**: `GET /product/search`
- **请求参数** (Query):
```
keyword: string      // 搜索关键词
page: number        // 页码
pageSize: number    // 每页数量
```
- **响应数据**: 同商品列表格式

---

## 3. 分类模块 (Category)

### 3.1 获取分类列表
- **接口路径**: `GET /category/list`
- **请求参数**: 无
- **响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": "number",
      "name": "string",
      "icon": "string",
      "parentId": "number",
      "children": "array"  // 子分类（可选）
    }
  ]
}
```

---

## 4. 购物车模块 (Cart)

### 4.1 获取购物车列表
- **接口路径**: `GET /cart/list`
- **请求参数**: 无（需要 token）
- **响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": "number",
      "productId": "number",
      "productName": "string",
      "productImage": "string",
      "price": "number",
      "quantity": "number",
      "selected": "boolean",
      "stock": "number"
    }
  ]
}
```

### 4.2 添加到购物车
- **接口路径**: `POST /cart/add`
- **请求参数**:
```json
{
  "productId": "number",
  "quantity": "number"
}
```
- **响应数据**:
```json
{
  "code": 200,
  "message": "添加成功",
  "data": {
    "cartId": "number"
  }
}
```

### 4.3 更新购物车
- **接口路径**: `POST /cart/update`
- **请求参数**:
```json
{
  "cartId": "number",
  "quantity": "number",    // 可选
  "selected": "boolean"    // 可选
}
```
- **响应数据**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

### 4.4 删除购物车商品
- **接口路径**: `DELETE /cart/delete/:id`
- **请求参数**: 
  - `id`: 购物车项ID（路径参数）
- **响应数据**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

---

## 5. 订单模块 (Order)

### 5.1 创建订单
- **接口路径**: `POST /order/create`
- **请求参数**:
```json
{
  "addressId": "number",
  "cartIds": ["number"],  // 购物车项ID数组
  "remark": "string"      // 订单备注（可选）
}
```
- **响应数据**:
```json
{
  "code": 200,
  "message": "订单创建成功",
  "data": {
    "orderId": "number",
    "orderNo": "string"
  }
}
```

### 5.2 获取订单列表
- **接口路径**: `GET /order/list`
- **请求参数** (Query):
```
status: number       // 订单状态（可选）：0-全部，1-待付款，2-待发货，3-待收货，4-已完成
page: number        // 页码
pageSize: number    // 每页数量
```
- **响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": "number",
        "orderNo": "string",
        "status": "number",
        "statusText": "string",
        "totalAmount": "number",
        "createdAt": "string",
        "items": [
          {
            "productId": "number",
            "productName": "string",
            "productImage": "string",
            "price": "number",
            "quantity": "number"
          }
        ]
      }
    ],
    "total": "number"
  }
}
```

### 5.3 获取订单详情
- **接口路径**: `GET /order/:id`
- **请求参数**: 
  - `id`: 订单ID（路径参数）
- **响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "number",
    "orderNo": "string",
    "status": "number",
    "statusText": "string",
    "totalAmount": "number",
    "createdAt": "string",
    "address": {
      "name": "string",
      "phone": "string",
      "province": "string",
      "city": "string",
      "district": "string",
      "detail": "string"
    },
    "items": "array",
    "remark": "string"
  }
}
```

### 5.4 取消订单
- **接口路径**: `POST /order/cancel/:id`
- **请求参数**: 
  - `id`: 订单ID（路径参数）
- **响应数据**:
```json
{
  "code": 200,
  "message": "订单已取消",
  "data": null
}
```

### 5.5 确认收货
- **接口路径**: `POST /order/confirm/:id`
- **请求参数**: 
  - `id`: 订单ID（路径参数）
- **响应数据**:
```json
{
  "code": 200,
  "message": "确认收货成功",
  "data": null
}
```

### 5.6 删除订单
- **接口路径**: `DELETE /order/delete/:id`
- **请求参数**: 
  - `id`: 订单ID（路径参数）
- **响应数据**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

---

## 6. 地址模块 (Address)

### 6.1 获取地址列表
- **接口路径**: `GET /address/list`
- **请求参数**: 无（需要 token）
- **响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": "number",
      "name": "string",
      "phone": "string",
      "province": "string",
      "city": "string",
      "district": "string",
      "detail": "string",
      "isDefault": "boolean"
    }
  ]
}
```

### 6.2 添加地址
- **接口路径**: `POST /address/add`
- **请求参数**:
```json
{
  "name": "string",
  "phone": "string",
  "province": "string",
  "city": "string",
  "district": "string",
  "detail": "string",
  "isDefault": "boolean"
}
```
- **响应数据**:
```json
{
  "code": 200,
  "message": "添加成功",
  "data": {
    "addressId": "number"
  }
}
```

### 6.3 更新地址
- **接口路径**: `POST /address/update/:id`
- **请求参数**: 
  - `id`: 地址ID（路径参数）
  - Body: 同添加地址
- **响应数据**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

### 6.4 删除地址
- **接口路径**: `DELETE /address/delete/:id`
- **请求参数**: 
  - `id`: 地址ID（路径参数）
- **响应数据**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

### 6.5 设置默认地址
- **接口路径**: `POST /address/setDefault/:id`
- **请求参数**: 
  - `id`: 地址ID（路径参数）
- **响应数据**:
```json
{
  "code": 200,
  "message": "设置成功",
  "data": null
}
```

---

## 7. 首页模块 (Home)

### 7.1 获取首页数据
- **接口路径**: `GET /home`
- **请求参数**: 无
- **响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "banners": [
      {
        "id": "number",
        "image": "string",
        "link": "string",
        "title": "string"
      }
    ],
    "categories": "array",
    "hotProducts": "array",     // 热门商品
    "newProducts": "array"      // 新品推荐
  }
}
```

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 401 | 未授权，需要登录 |
| 403 | 禁止访问 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

---

## 后端实现建议

### 1. 项目结构
```
backend/
├── src/
│   ├── routes/          # 路由
│   │   ├── user.js
│   │   ├── product.js
│   │   ├── cart.js
│   │   ├── order.js
│   │   ├── address.js
│   │   ├── category.js
│   │   └── home.js
│   ├── controllers/     # 控制器
│   ├── models/          # 数据模型
│   ├── middleware/      # 中间件（认证、错误处理等）
│   ├── utils/           # 工具函数
│   └── app.js          # 主应用
├── package.json
└── .env                # 环境变量
```

### 2. 必需的 npm 包
```json
{
  "dependencies": {
    "express": "^4.18.0",
    "cors": "^2.8.5",
    "jsonwebtoken": "^9.0.0",
    "bcryptjs": "^2.4.3",
    "dotenv": "^16.0.0",
    "mongoose": "^7.0.0"  // 或其他 ORM
  }
}
```

### 3. CORS 配置
前端开发环境可能运行在不同端口，需要配置 CORS：
```javascript
app.use(cors({
  origin: 'http://localhost:5173',  // Vite 默认端口
  credentials: true
}));
```

### 4. JWT 认证中间件示例
```javascript
const jwt = require('jsonwebtoken');

const authMiddleware = (req, res, next) => {
  const token = req.headers.authorization?.replace('Bearer ', '');
  if (!token) {
    return res.status(401).json({ code: 401, message: '未授权' });
  }
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.userId = decoded.userId;
    next();
  } catch (error) {
    res.status(401).json({ code: 401, message: 'Token 无效' });
  }
};
```

### 5. 统一响应格式中间件
```javascript
const responseFormatter = (req, res, next) => {
  res.success = (data = null, message = 'success') => {
    res.json({ code: 200, message, data });
  };
  res.error = (message = 'error', code = 500) => {
    res.status(code).json({ code, message, data: null });
  };
  next();
};
```

---

## 数据库设计建议

### 主要数据表
1. **users** - 用户表
2. **products** - 商品表
3. **categories** - 分类表
4. **cart** - 购物车表
5. **orders** - 订单表
6. **order_items** - 订单商品表
7. **addresses** - 地址表
8. **banners** - 轮播图表

---

## 联调注意事项

1. **跨域问题**: 确保后端正确配置 CORS
2. **Token 传递**: 前端会在请求头中携带 `Authorization: Bearer <token>`
3. **响应格式**: 严格按照文档中的响应格式返回数据
4. **错误处理**: 使用统一的错误码和错误信息
5. **分页参数**: 统一使用 `page` 和 `pageSize`
6. **日期格式**: 建议使用 ISO 8601 格式（如：2024-01-01T00:00:00.000Z）

---

## 测试工具推荐
- **Postman** - API 测试
- **Apifox** - API 文档和测试
- **Thunder Client** - VS Code 插件

---

**文档版本**: v1.0  
**更新日期**: 2024-12-08  
**维护人员**: 前端团队
